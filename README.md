# autolanding
planning 代码

没有准备的过程：
Step1: 发布一下还没有准备的信息
准备起飞的过程：
Step1: 发布准备开始的信息
跟踪过程中的步骤：
Step1: 得到无人机自己的相关信息p546
Step2: 得到目标物(车辆)的相关信息p561
Step3: 设置跟踪目标。P585
Step4: 建图得到地图的信息p614
Step5: 预测车辆的路径。P630
Step6: 重规划飞机目前的状态（包括位置，速度和加速度等）p647
Step7: 前端优化路径，采用的是Astar方法，启发函数应该是Elastic Tracker中的方法p667
Step8: 生成一个可见的区域，已经就是那个扇形的区域p682
Step9: 生成飞行走廊p700
Step10: 轨迹优化，就是用到论文里的那些惩罚p710
Step11: 检测碰撞
      如果没有发生碰撞，那么便表明优化的路径是没有的问题的。
      如果轨迹有问题，并且具有强制悬停的标志的话，那么无人机将进行悬停
      如果发现轨迹有问题的话，并且没有具有强制悬停的标志的话，检查上一段轨迹是否发生了碰撞，假如发生了碰撞，那么便让无人机紧急悬停
      如果发现轨迹有问题，并且没有强制悬停，上一段轨迹也没有发生碰撞的情况下，取消这次的规划，返回上一段的轨迹，重新规划。
降落过程中的步骤：
Step1: 得到无人机自己的相关信息p775
Step2: 得到目标物(车辆)的相关信息p793
Step3: 检查是否可以开始降落p846
      当距离足够近的时候，那么便可以切换到CALI模式了
      当距离还没有到达足够近的时候，那么不要进行悬停
Step4: 建图得到地图的信息p876
      检查飞机和车辆之间是否存在障碍物p884
Step5: 预测车辆的路径。并且画出车辆的可视边缘P891
Step6: 重规划飞机目前的状态（包括位置，速度和加速度等）p907
Step7: 前端优化路径，采用的是Astar方法，启发函数应该是Elastic Tracker中的方法p928
Step8: 生成飞行走廊p941（这里就不用生成可见区域了，因为此时无人机理应来说应该就在             车辆的正上方了，所以根本不需要这个飞行走廊了）
Step9: 轨迹优化，就是用到论文里的那些惩罚p951
Step10: 检测碰撞
      如果没有发生碰撞，那么便表明优化的路径是没有的问题的。
      如果轨迹有问题，并且具有强制悬停的标志的话，那么无人机将进行悬停
      如果发现轨迹有问题的话，并且没有具有强制悬停的标志的话，检查上一段轨迹是否发生了碰撞，假如发生了碰撞，那么便让无人机紧急悬停
      如果发现轨迹有问题，并且没有强制悬停，上一段轨迹也没有发生碰撞的情况下，取消这次的规划，返回上一段的轨迹，重新规划。
校准过程中的步骤:
Step1: 发布信息，无人机目前正处于校准的状态。

         这里就会导致会执行ctrl_timer_callback的回调函数。
     这里回调函数的步骤如下：
    Step1: 得到无人机自己的相关信息p372
    Step2: 得到目标物(车辆)的相关信息p389
    Step3: 预测车辆在未来一段时间内的轨迹p403
    Step4: 计算无人机和车辆的距离差和速度差p412
    Step5: 判断是否可以降落，如果在上面校准的很好，速度也差不多，发布消息可以稳定运行。假如校准过高，就慢慢的往下降，最终可以得到校准过程中无人机的位置和速度
Step2: 当校准完成之后，无人机降落完成，发布信息提示。
降落完成的步骤：
Step1: 发布信息降落完成。
          转到land_triger_callback回调函数p274
         获得降落时飞机的位置和四元数




Debug mode 就不介绍了
![image](https://user-images.githubusercontent.com/95516449/228598666-bdb0814e-619c-4a11-9278-cc4b2c22b3db.png)
